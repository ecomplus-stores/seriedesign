!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@ecomplus/shopping-cart"),require("@ecomplus/utils")):"function"==typeof define&&define.amd?define([,],t):"object"==typeof exports?exports.widgetAnalytics=t(require("@ecomplus/shopping-cart"),require("@ecomplus/utils")):e.widgetAnalytics=t(e.ecomCart,e.ecomUtils)}(window,(function(e,t){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var c=t[n]={i:n,l:!1,exports:{}};return e[n].call(c.exports,c,c.exports,o),c.l=!0,c.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)o.d(n,c,function(t){return e[t]}.bind(null,c));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/assets/vendor/",o(o.s=2)}([function(t,o){t.exports=e},function(e,o){e.exports=t},function(e,t,o){"use strict";o.r(t);var n=o(0),c=o.n(n),r=o(1);const i=r.$ecomConfig.get("currency")||"BRL",a=e=>{const t={name:Object(r.name)(e),id:e.sku,price:Object(r.price)(e).toFixed(2)};return e.quantity&&(t.quantity=e.quantity),t};const{location:u,$:s}=window;var d=(e,t)=>{const o=()=>setTimeout(()=>{e("event","page_view",{page_title:document.title||"Checkout",page_path:"/"+u.hash.split("/")[1],send_to:t})},300);(e=>{const t=window.storefrontApp&&window.storefrontApp.router;if(t){let o,n,r;const u=()=>{const e=[];return c.a.data&&Array.isArray(c.a.data.items)&&c.a.data.items.forEach(t=>{e.push(a(t))}),e},s=t=>{e.push({event:"eec.checkout_option",ecommerce:{currencyCode:i,checkout_option:{actionField:t}}})},d=(t,c)=>{const r={step:t,option:c};t<=1||!o?(e.push({event:"eec.checkout",ecommerce:{currencyCode:i,checkout:{actionField:r,products:u()}}}),e.push({event:"checkout"}),o=!0):n||(s(r),e.push({event:"checkoutOption"}),n=!0)},p=(t,o)=>{if(!r){const{amount:n}=window.storefrontApp,a={id:t,revenue:(n&&n.total||c.a.data&&c.a.data.subtotal||0).toFixed(2)};let d;if(n&&(void 0!==n.freight&&(a.shipping=n.freight.toFixed(2)),void 0!==n.tax&&(a.tax=n.tax.toFixed(2))),o)try{d=JSON.parse(o)}catch(e){}d&&(["payment_method_label","shipping_method_label"].forEach((e,t)=>{d[e]&&s({step:3+t,option:d[e]})}),d.extra_discount&&d.extra_discount.discount_coupon&&(a.coupon=d.extra_discount.discount_coupon)),e.push({event:"eec.purchase",ecommerce:{currencyCode:i,purchase:{actionField:a,products:u()}}}),r=!0}};let l;const m=({name:e,params:t})=>{switch(e){case"cart":d(1,"Review Cart");break;case"checkout":d(2,"Confirm Purchase");break;case"confirmation":clearTimeout(l),t.json?p(t.id,decodeURIComponent(t.json)):l=setTimeout(()=>{p(t.id)},1500)}};t.currentRoute&&m(t.currentRoute),t.afterEach(m)}})({push:({event:t,ecommerce:n})=>{let c;switch(t){case"eec.checkout":case"eec.checkout_option":c=n&&n.checkout,c&&e("event","begin_checkout",{items:c.products}),e("event","set_checkout_option",{checkout_step:u.hash.startsWith("#/cart")?1:2});break;case"eec.purchase":o(),c=n&&n.purchase,c&&c.actionField&&e("event","purchase",{transaction_id:c.actionField.id,affiliation:s('meta[name="author"]').attr("content")||"Shop",value:Number(c.actionField.revenue),currency:n.currencyCode,tax:c.actionField.tax?Number(c.actionField.tax):0,shipping:c.actionField.shipping?Number(c.actionField.shipping):0,items:c.products});break;default:o()}}})},p=e=>{(e=>{const t={},o=o=>{const n=a(o);e.push({event:"eec.add",ecommerce:{currencyCode:i,add:{products:[n]}}}),e.push({event:"addToCart"}),t[o.sku]=n},n=o=>{const n=t[o.sku];e.push({event:"eec.remove",ecommerce:{currencyCode:i,remove:{products:[n?Object.assign({},n):a(o)]}}}),e.push({event:"removeFromCart"}),delete t[o.sku]};c.a.on("addItem",({item:e})=>o(e)),c.a.on("increaseItemQnt",({item:e})=>{const c=t[e.sku];if(c){const t=e.quantity-c.quantity;t>0?o({...e,quantity:t}):n({...e,quantity:-t})}else o(e)}),c.a.on("removeItem",({item:e})=>n(e)),c.a.on("clear",()=>{for(const e in t)t[e]&&n(t[e])})})({push:({event:t,ecommerce:o})=>{if(o&&("eec.add"===t||"eec.remove"===t)){const n=o[t.slice(4)];n&&n.products&&e("event","eec.add"===t?"add_to_cart":"remove_from_cart",{items:n.products})}}})};t.default=(e={})=>{const{gaTrackingId:t}=e,{gtag:o}=window;"function"==typeof o&&(d(o,t),p(o))}}]).default}));
//# sourceMappingURL=widget-analytics.min.js.map