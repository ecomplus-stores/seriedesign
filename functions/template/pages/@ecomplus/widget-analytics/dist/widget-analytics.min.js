!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@ecomplus/shopping-cart"),require("@ecomplus/utils")):"function"==typeof define&&define.amd?define([,],t):"object"==typeof exports?exports.widgetAnalytics=t(require("@ecomplus/shopping-cart"),require("@ecomplus/utils")):e.widgetAnalytics=t(e.ecomCart,e.ecomUtils)}(window,(function(e,t){return function(e){var t={};function o(c){if(t[c])return t[c].exports;var n=t[c]={i:c,l:!1,exports:{}};return e[c].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,c){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:c})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var c=Object.create(null);if(o.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(c,n,function(t){return e[t]}.bind(null,n));return c},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/assets/vendor/",o(o.s=2)}([function(t,o){t.exports=e},function(e,o){e.exports=t},function(e,t,o){"use strict";o.r(t);var c=o(0),n=o.n(c),r=o(1);const i=r.$ecomConfig.get("currency")||"BRL",a=e=>{const t={name:Object(r.name)(e),id:e.sku,price:Object(r.price)(e).toFixed(2)};return e.quantity&&(t.quantity=e.quantity),t};const{location:u,$:s}=window;var d=(e,t)=>{const o=()=>setTimeout(()=>{e("event","page_view",{page_title:document.title||"Checkout",page_path:"/"+u.hash.split("/")[1],send_to:t})},300);(e=>{const t=window.storefrontApp&&window.storefrontApp.router;if(t){let o,c,r;const u=()=>{const e=[];return n.a.data&&Array.isArray(n.a.data.items)&&n.a.data.items.forEach(t=>{e.push(a(t))}),e},s=(t,n)=>{const r={step:t,option:n};t<=1||!o?(e.push({event:"eec.checkout",ecommerce:{currencyCode:i,checkout:{actionField:r,products:u()}}}),e.push({event:"checkout"}),o=!0):c||(e.push({event:"eec.checkout_option",ecommerce:{currencyCode:i,checkout_option:{actionField:r}}}),e.push({event:"checkoutOption"}),c=!0)},d=t=>{if(!r){const{amount:o}=window.storefrontApp,c={id:t,revenue:(o&&o.total||n.a.data&&n.a.data.subtotal||0).toFixed(2)};o&&(void 0!==o.freight&&(c.shipping=o.freight.toFixed(2)),void 0!==o.tax&&(c.tax=o.tax.toFixed(2))),e.push({event:"eec.purchase",ecommerce:{currencyCode:i,purchase:{actionField:c,products:u()}}}),r=!0}},p=({name:e,params:t})=>{switch(e){case"cart":s(1,"Review Cart");break;case"checkout":s(2,"Confirm Purchase");break;case"confirmation":d(t.id)}};t.currentRoute&&p(t.currentRoute),t.afterEach(p)}})({push:({event:t,ecommerce:c})=>{let n;switch(t){case"eec.checkout":case"eec.checkout_option":n=c&&c.checkout,n&&e("event","begin_checkout",{items:n.products}),e("event","set_checkout_option",{checkout_step:u.hash.startsWith("#/cart")?1:2});break;case"eec.purchase":o(),n=c&&c.purchase,n&&n.actionField&&e("event","purchase",{transaction_id:n.actionField.id,affiliation:s('meta[name="author"]').attr("content")||"Shop",value:Number(n.actionField.revenue),currency:c.currencyCode,tax:n.actionField.tax?Number(n.actionField.tax):0,shipping:n.actionField.shipping?Number(n.actionField.shipping):0,items:n.products});break;default:o()}}})},p=e=>{(e=>{const t={},o=o=>{const c=a(o);e.push({event:"eec.add",ecommerce:{currencyCode:i,add:{products:[c]}}}),e.push({event:"addToCart"}),t[o.sku]=c},c=o=>{const c=t[o.sku];e.push({event:"eec.remove",ecommerce:{currencyCode:i,remove:{products:[c?Object.assign({},c):a(o)]}}}),e.push({event:"removeFromCart"}),delete t[o.sku]};n.a.on("addItem",({item:e})=>o(e)),n.a.on("increaseItemQnt",({item:e})=>{const n=t[e.sku];if(n){const t=e.quantity-n.quantity;t>0?o({...e,quantity:t}):c({...e,quantity:-t})}else o(e)}),n.a.on("removeItem",({item:e})=>c(e)),n.a.on("clear",()=>{for(const e in t)t[e]&&c(t[e])})})({push:({event:t,ecommerce:o})=>{if(o&&("eec.add"===t||"eec.remove"===t)){const c=o[t.slice(4)];c&&c.products&&e("event","eec.add"===t?"add_to_cart":"remove_from_cart",{items:c.products})}}})};t.default=(e={})=>{const{gaTrackingId:t}=e,{gtag:o}=window;"function"==typeof o&&(d(o,t),p(o))}}]).default}));
//# sourceMappingURL=widget-analytics.min.js.map