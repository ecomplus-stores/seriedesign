!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@ecomplus/shopping-cart"),require("@ecomplus/utils")):"function"==typeof define&&define.amd?define([,],t):"object"==typeof exports?exports.widgetTagManager=t(require("@ecomplus/shopping-cart"),require("@ecomplus/utils")):e.widgetTagManager=t(e.ecomCart,e.ecomUtils)}(window,(function(e,t){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/assets/vendor/",o(o.s=2)}([function(t,o){t.exports=e},function(e,o){e.exports=t},function(e,t,o){"use strict";o.r(t);var r=o(1);const n=r.$ecomConfig.get("currency")||"BRL",c=e=>{const t={name:Object(r.name)(e),id:e.sku,price:Object(r.price)(e).toFixed(2)};return e.quantity&&(t.quantity=e.quantity),t};var a=o(0),s=o.n(a);t.default=(e={})=>{const{dataLayerVar:t,parseDomMsDelay:o}=e,a=window[t]||window.dataLayer;a&&((e=>{const t=window.storefront&&window.storefront.context;if(t&&"products"===t.resource){const{body:o}=t,a=c(o),s={event:"eec.detail",ecommerce:{currencyCode:n,detail:{products:[a]}}},i=Object(r.categoriesList)(o);i.length&&(a.category=o.category_tree?o.category_tree.replace(/\s>\s/g,"/"):i[0],s.ecommerce.detail.actionField={list:i[0]}),o.brands&&o.brands.length&&(a.brand=o.brands[0].name),e.push(s)}})(a),(e=>{const t=window.storefrontApp&&window.storefrontApp.router;if(t){let o,r,a;const i=()=>{const e=[];return s.a.data&&Array.isArray(s.a.data.items)&&s.a.data.items.forEach(t=>{e.push(c(t))}),e},u=t=>{e.push({event:"eec.checkout_option",ecommerce:{currencyCode:n,checkout_option:{actionField:t}}})},d=(t,c)=>{const a={step:t,option:c};t<=1||!o?(e.push({event:"eec.checkout",ecommerce:{currencyCode:n,checkout:{actionField:a,products:i()}}}),e.push({event:"checkout"}),o=!0):r||(u(a),e.push({event:"checkoutOption"}),r=!0)},p=(t,o)=>{if(!a){const{amount:r}=window.storefrontApp,c={id:t,revenue:(r&&r.total||s.a.data&&s.a.data.subtotal||0).toFixed(2)};let d;if(r&&(void 0!==r.freight&&(c.shipping=r.freight.toFixed(2)),void 0!==r.tax&&(c.tax=r.tax.toFixed(2))),o)try{d=JSON.parse(o)}catch(e){}d&&(["payment_method_label","shipping_method_label"].forEach((e,t)=>{d[e]&&u({step:3+t,option:d[e]})}),d.extra_discount&&d.extra_discount.discount_coupon&&(c.coupon=d.extra_discount.discount_coupon)),e.push({event:"eec.purchase",ecommerce:{currencyCode:n,purchase:{actionField:c,products:i()}}}),a=!0}};let l;const m=({name:e,params:t})=>{switch(e){case"cart":d(1,"Review Cart");break;case"checkout":d(2,"Confirm Purchase");break;case"confirmation":clearTimeout(l),t.json?p(t.id,decodeURIComponent(t.json)):l=setTimeout(()=>{p(t.id)},1500)}};t.currentRoute&&m(t.currentRoute),t.afterEach(m)}})(a),(e=>{const t={},o=o=>{const r=c(o);e.push({event:"eec.add",ecommerce:{currencyCode:n,add:{products:[r]}}}),e.push({event:"addToCart"}),t[o.sku]=r},r=o=>{const r=t[o.sku];e.push({event:"eec.remove",ecommerce:{currencyCode:n,remove:{products:[r?Object.assign({},r):c(o)]}}}),e.push({event:"removeFromCart"}),delete t[o.sku]};s.a.on("addItem",({item:e})=>o(e)),s.a.on("increaseItemQnt",({item:e})=>{const n=t[e.sku];if(n){const t=e.quantity-n.quantity;t>0?o({...e,quantity:t}):r({...e,quantity:-t})}else o(e)}),s.a.on("removeItem",({item:e})=>r(e)),s.a.on("clear",()=>{for(const e in t)t[e]&&r(t[e])})})(a),setTimeout(()=>{(e=>{const t=document.querySelectorAll("[data-sku]");if(t.length){const o=[],r={},c="/search"===window.location.pathname;for(let e=0;e<t.length;e++){const n=t[e],{sku:a}=n.dataset;if(-1===o.indexOf(a)&&(o.push(a),n.closest)){const e=n.closest(".products-carousel");!c&&e&&(r[a]=e.dataset.title)}}e.push({event:"eec.impressions",ecommerce:{currencyCode:n,impressions:o.map(e=>{const t=c?"Search results":r[e],o={id:e};return t&&(o.list=t),o})}})}})(a)},o>=0?o:300))}}]).default}));
//# sourceMappingURL=widget-tag-manager.min.js.map