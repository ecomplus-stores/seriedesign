!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@ecomplus/utils"),require("vue"),require("@ecomplus/passport-client")):"function"==typeof define&&define.amd?define([,,],e):"object"==typeof exports?exports.widgetUser=e(require("@ecomplus/utils"),require("vue"),require("@ecomplus/passport-client")):t.widgetUser=e(t.ecomUtils,t.Vue,t.EcomPassport)}(window,(function(t,e,o){return function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/assets/vendor/",o(o.s=12)}([function(e,o){e.exports=t},function(t,e,o){var i=o(9);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,o(4).default)("3ce2dc8f",i,!0,{})},function(t,e,o){var i=o(11);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,o(4).default)("5dd81475",i,!0,{})},function(t,e,o){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var o=function(t,e){var o=t[1]||"",i=t[3];if(!i)return o;if(e&&"function"==typeof btoa){var n=(s=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(l," */")),r=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[o].concat(r).concat([n]).join("\n")}var s,a,l;return[o].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(o,"}"):o})).join("")},e.i=function(t,o,i){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(i)for(var r=0;r<this.length;r++){var s=this[r][0];null!=s&&(n[s]=!0)}for(var a=0;a<t.length;a++){var l=[].concat(t[a]);i&&n[l[0]]||(o&&(l[2]?l[2]="".concat(o," and ").concat(l[2]):l[2]=o),e.push(l))}},e}},function(t,e,o){"use strict";function i(t,e){for(var o=[],i={},n=0;n<e.length;n++){var r=e[n],s=r[0],a={id:t+":"+n,css:r[1],media:r[2],sourceMap:r[3]};i[s]?i[s].parts.push(a):o.push(i[s]={id:s,parts:[a]})}return o}o.r(e),o.d(e,"default",(function(){return h}));var n="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!n)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var r={},s=n&&(document.head||document.getElementsByTagName("head")[0]),a=null,l=0,c=!1,u=function(){},d=null,p="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function h(t,e,o,n){c=o,d=n||{};var s=i(t,e);return f(s),function(e){for(var o=[],n=0;n<s.length;n++){var a=s[n];(l=r[a.id]).refs--,o.push(l)}e?f(s=i(t,e)):s=[];for(n=0;n<o.length;n++){var l;if(0===(l=o[n]).refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete r[l.id]}}}}function f(t){for(var e=0;e<t.length;e++){var o=t[e],i=r[o.id];if(i){i.refs++;for(var n=0;n<i.parts.length;n++)i.parts[n](o.parts[n]);for(;n<o.parts.length;n++)i.parts.push(g(o.parts[n]));i.parts.length>o.parts.length&&(i.parts.length=o.parts.length)}else{var s=[];for(n=0;n<o.parts.length;n++)s.push(g(o.parts[n]));r[o.id]={id:o.id,refs:1,parts:s}}}}function m(){var t=document.createElement("style");return t.type="text/css",s.appendChild(t),t}function g(t){var e,o,i=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(i){if(c)return u;i.parentNode.removeChild(i)}if(p){var n=l++;i=a||(a=m()),e=_.bind(null,i,n,!1),o=_.bind(null,i,n,!0)}else i=m(),e=y.bind(null,i),o=function(){i.parentNode.removeChild(i)};return e(t),function(i){if(i){if(i.css===t.css&&i.media===t.media&&i.sourceMap===t.sourceMap)return;e(t=i)}else o()}}var v,b=(v=[],function(t,e){return v[t]=e,v.filter(Boolean).join("\n")});function _(t,e,o,i){var n=o?"":i.css;if(t.styleSheet)t.styleSheet.cssText=b(e,n);else{var r=document.createTextNode(n),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(r,s[e]):t.appendChild(r)}}function y(t,e){var o=e.css,i=e.media,n=e.sourceMap;if(i&&t.setAttribute("media",i),d.ssrId&&t.setAttribute("data-vue-ssr-id",e.id),n&&(o+="\n/*# sourceURL="+n.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}},function(t,o){t.exports=e},function(t,e){t.exports=o},,function(t,e,o){"use strict";var i=o(1);o.n(i).a},function(t,e,o){(e=o(3)(!1)).push([t.i,".backdrop{position:fixed;top:-100vh;left:0;width:100vw;height:100vh;background-color:var(--dark);opacity:.65;cursor:pointer;z-index:-100}",""]),t.exports=e},function(t,e,o){"use strict";var i=o(2);o.n(i).a},function(t,e,o){(e=o(3)(!1)).push([t.i,".login-modal__box{z-index:1090;position:fixed;top:0;left:0;width:100vw;box-sizing:border-box;border-radius:0}@media (min-width:410px){.login-modal__box{width:400px;left:50%;margin-left:-200px;top:var(--spacer-4);border-radius:var(--border-radius)}}@media (min-height:400px){.login-modal__box{top:15%}}.login-modal .alert{margin-bottom:var(--spacer-3)}.login-modal__logout{margin-top:var(--spacer-3)}.login-modal__btn{color:#fff;text-align:left;line-height:var(--line-height-lg);padding:.7rem;min-width:15rem}.login-modal__btn:hover{color:#fff}.login-modal__btn:focus{box-shadow:none}.login-modal__btn--facebook{background:#3b5999;border-color:#2f4d8a}.login-modal__btn--facebook:hover{background:#274480;border-color:#274480}.login-modal__btn--google{background:#cb4023;border-color:#be3419}.login-modal__btn--google:hover{background:#c1361a;border-color:#c1361a}.login-modal__btn--windowslive{background:#329ffc;border-color:#2996f2}.login-modal__btn--windowslive:hover{background:#1f8ce9;border-color:#1f8ce9}.login-modal__btn-icon{display:inline-block;width:1.4rem;text-align:center;margin-right:var(--spacer-1)}.login-modal__back{display:block;padding-left:.3rem;padding-right:.3rem}.login-modal__back:focus{box-shadow:none}.login-modal__visitor-info{font-size:var(--font-size-sm);margin-top:var(--spacer-2);text-align:center;color:var(--text-muted)}",""]),t.exports=e},function(t,e,o){"use strict";o.r(e);var i=o(5),n=o.n(i);const r={en_us:"Close",pt_br:"Fechar"},s={en_us:"Continue login on popup",pt_br:"Continue o login na popup"},a={en_us:"Email",pt_br:"E-mail"},l={en_us:"If you prefer, you can also continue shopping as a visitor.",pt_br:"Se preferir, você também pode continuar comprando como visitante."},c={en_us:"Hello",pt_br:"Olá"},u={en_us:"Login",pt_br:"Login"},d={en_us:"There was an error trying to login, please try again or select another option.",pt_br:"Houve um erro ao tentar o login, por favor tente novamente ou tente outra opção."},p={en_us:"Logout",pt_br:"Sair"},h={en_us:"My account",pt_br:"Minha conta"},f={en_us:"My orders",pt_br:"Meus pedidos"},m={en_us:"No profile found with email",pt_br:"Nenhum perfil encontrado pelo e-mail"},g={en_us:"Sign in with",pt_br:"Entrar com"},v={en_us:"Sign in with another email",pt_br:"Entrar com outro e-mail"},b={en_us:"Sign up with",pt_br:"Cadastrar via"},_={en_us:"Visitor",pt_br:"Visitante"};var y=o(0),w=o(6),x=o.n(w);function k(t,e,o,i,n,r,s,a){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=o,c._compiled=!0),i&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),s?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=l):n&&(l=a?function(){n.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:n),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(t,e){return l.call(e),u(t,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:c}}var C=k({name:"ALink",props:{href:String,to:[String,Object]},computed:{isRouter(){return!!this.$router&&(!this.href||Boolean(this.$router.options.routes.find(({path:t})=>t===this.href)))}}},(function(){var t=this.$createElement;return(this._self._c||t)(this.isRouter?"router-link":"a",{tag:"component",attrs:{href:this.isRouter?null:this.href,to:this.isRouter?this.to||this.href:null}},[this._t("default")],2)}),[],!1,null,null,null).exports,P=k({name:"AAlert",props:{canShow:{type:Boolean,default:!0},variant:{type:String,default:"warning"}},data:()=>({count:1}),computed:{i19close:()=>Object(y.i18n)(r)},watch:{canShow(t){t&&this.count++}}},(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("transition",{attrs:{"enter-active-class":"animated fadeInDown fast"}},[this.canShow?e("div",{key:this.count},[this._m(0)]):this._e()])],1)}),[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"alert alert-dismissible fade show",class:"alert-"+t.variant,attrs:{role:"alert"}},[t._t("default"),o("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"alert","aria-label":t.i19close},on:{click:function(e){return t.$emit("dismiss")}}},[o("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])],2)}],!1,null,null,null).exports,O={name:"ABackdrop",props:{isVisible:{type:Boolean,default:!0},zIndexOnShow:{type:Number,default:1080},transitionMs:{type:Number,default:150}},data:()=>({opacity:0,zIndex:null,top:null}),computed:{style(){const{top:t,zIndex:e,transitionMs:o,opacity:i}=this;return{top:t,transition:`opacity ${o}ms linear`,opacity:i,zIndex:e}}},methods:{hide(){this.$emit("update:is-visible",!1),this.$emit("hide")},lockBodyScroll(){document.body.style.maxWidth=document.body.offsetWidth+"px",document.body.style.overflow="hidden"}},watch:{isVisible(t){t?(this.opacity=null,this.lockBodyScroll()):(this.opacity=0,document.body.style.overflow=document.body.style.maxWidth=null)},opacity(t){0===t?setTimeout(()=>{this.top=this.zIndex=null},this.transitionMs):(this.zIndex=this.zIndexOnShow,this.top=0)}},mounted(){this.isVisible&&(setTimeout(()=>{this.opacity=null},this.transitionMs),this.lockBodyScroll())}},S=(o(8),{name:"LoginModal",components:{ALink:C,AAlert:P,ABackdrop:k(O,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"backdrop",style:this.style,on:{click:this.hide}})}),[],!1,null,null,null).exports},props:{isVisible:{type:Boolean,default:!0},getGreetingsMsg:Function,accountUrl:{type:String,default:"/app/#/account/"},ordersUrl:{type:String,default:"/app/#/account/orders"},ecomPassport:{type:Object,default:()=>x.a}},data:()=>({isLoading:!1,isWaitingPopup:!1,isLogged:!1,email:"",name:"",oauthProviders:[],isLoginForm:!1,hasLoginError:!1,hasNoProfileFound:!1}),computed:{i19close:()=>Object(y.i18n)(r),i19continueLoginOnPopup:()=>Object(y.i18n)(s),i19email:()=>Object(y.i18n)(a),i19guestCheckoutMsg:()=>Object(y.i18n)(l),i19loginErrorMsg:()=>Object(y.i18n)(d),i19login:()=>Object(y.i18n)(u),i19logout:()=>Object(y.i18n)(p),i19myAccount:()=>Object(y.i18n)(h),i19myOrders:()=>Object(y.i18n)(f),i19noProfileFoundWithEmail:()=>Object(y.i18n)(m),i19signInWith:()=>Object(y.i18n)(g),i19signInWithAnotherEmail:()=>Object(y.i18n)(v),i19signUpWith:()=>Object(y.i18n)(b),greetings(){return"function"==typeof this.getGreetingsMsg?this.getGreetingsMsg(this.name):`${Object(y.i18n)(c)} ${this.name||Object(y.i18n)(_)}`}},methods:{hide(){this.$emit("update:is-visible",!1)},update(){const{checkLogin:t,getCustomerName:e}=this.ecomPassport;this.name=e(),this.isLogged=t(),this.email="",this.isWaitingPopup=!1},waitPromise(t){this.isLoading=!0,t.catch(console.error).finally(()=>{this.isLoading=!1})},setOauthProviders(){const t=this.ecomPassport.fetchOauthProviders().then(({host:t,baseUri:e,oauthPath:o,providers:i})=>{const n=[];for(const r in i)if(i[r]){const{faIcon:s,providerName:a}=i[r];n.push({link:t+e+r+o,faIcon:s,provider:r,providerName:a})}this.oauthProviders=n}).catch(t=>{throw this.presetOauthProviders(),t});return this.waitPromise(t),t},presetOauthProviders(){this.oauthProviders=[{faIcon:"fa-facebook-f",providerName:"Facebook",provider:"facebook"},{faIcon:"fa-google",providerName:"Google",provider:"google"},{faIcon:"fa-windows",providerName:"Windows",provider:"windowslive"}]},openOauthPopup(t,e){if(this.hasLoginError=!1,t)this.ecomPassport.popupOauthLink(t),this.isWaitingPopup=!0;else{const t=this.setOauthProviders().then(()=>{const t=this.oauthProviders.find(t=>t.provider===e);this.openOauthPopup(t,e)}).catch(t=>{throw this.hasLoginError=!0,t});this.waitPromise(t)}},submitEmail(){this.isLoginForm=!1;const t=this.ecomPassport.fetchLogin(this.email).catch(t=>{const{response:e}=t;if(!e||403!==e.status)throw setTimeout(()=>{this.hasLoginError=!0},100),t;this.hasNoProfileFound=!0});this.waitPromise(t)},logout(){this.ecomPassport.logout()}},watch:{hasNoProfileFound(t){!1===t&&(this.email=""),this.isLoginForm=!t},isLoginForm(t){this.hasLoginError=!1,t&&(this.isWaitingPopup=!1,this.$nextTick(()=>{setTimeout(()=>{this.$refs.input.focus()},200)}))}},mounted(){["login","logout"].forEach(t=>{this.ecomPassport.on(t,e=>{this.update(),this.$emit(t,e)})}),this.update(),this.setOauthProviders()}}),L=(o(10),k(S,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"login-modal"},[o("a-backdrop",{attrs:{"is-visible":t.isVisible},on:{hide:t.hide}}),o("transition",{attrs:{"enter-active-class":"animated zoomIn","leave-active-class":"animated fadeOutUp slow"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.isVisible,expression:"isVisible"}],staticClass:"login-modal__box card"},[t._t("header",[o("div",{staticClass:"login-modal__header card-header"},[t._v(" "+t._s(t.greetings)+" "),o("button",{staticClass:"close",attrs:{type:"button","aria-label":t.i19close},on:{click:t.hide}},[o("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])]),o("div",{staticClass:"login-modal__body card-body"},[t.hasLoginError?o("div",{staticClass:"alert alert-warning",attrs:{role:"alert"}},[t._v(" "+t._s(t.i19loginErrorMsg)+" ")]):t._e(),o("transition-group",{attrs:{"enter-active-class":"animated fadeIn","leave-active-class":"animated position-absolute fadeOut faster"}},[t.isLoading?o("div",{key:"waiting"},[o("div",{staticClass:"spinner-border m-3",attrs:{role:"status"}},[o("span",{staticClass:"sr-only"},[t._v("Loading...")])])]):t.isLogged?o("div",{key:"logged"},[o("div",{staticClass:"list-group list-group-flush"},[o("a-link",{staticClass:"list-group-item list-group-item-action",attrs:{href:t.ordersUrl}},[t._v(" "+t._s(t.i19myOrders)+" ")]),o("a-link",{staticClass:"list-group-item list-group-item-action",attrs:{href:t.accountUrl}},[t._v(" "+t._s(t.i19myAccount)+" ")])],1),o("button",{staticClass:"login-modal__logout btn btn-block btn-danger",attrs:{type:"button"},on:{click:t.logout}},[o("i",{staticClass:"fas fa-sign-out-alt"}),t._v(" "+t._s(t.i19logout)+" ")])]):t.isLoginForm?o("div",{key:"form"},[o("form",{on:{submit:function(e){return e.preventDefault(),t.submitEmail(e)}}},[o("div",{staticClass:"form-group"},[o("button",{staticClass:"login-modal__back btn",attrs:{type:"button"},on:{click:function(e){t.isLoginForm=!1}}},[o("i",{staticClass:"fas fa-arrow-left"})]),o("label",{attrs:{for:"login-modal-email"}},[t._v(" "+t._s(t.i19signInWith+" "+t.i19email)+" ")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],ref:"input",staticClass:"form-control",attrs:{type:"email",id:"login-modal-email",placeholder:"email@mail.com",required:""},domProps:{value:t.email},on:{input:function(e){e.target.composing||(t.email=e.target.value)}}})]),o("button",{staticClass:"btn btn-block btn-primary",attrs:{type:"submit"}},[t._v(" "+t._s(t.i19login)+" ")])])]):o("div",{key:"oauth"},[!t.isWaitingPopup&&t.hasNoProfileFound?o("div",{staticClass:"alert alert-info",attrs:{role:"alert"}},[t._v(" "+t._s(t.i19noProfileFoundWithEmail)+" "),o("b",[t._v(t._s(t.email))]),t._v(". "),o("br"),o("a",{staticClass:"alert-link",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.hasNoProfileFound=!1}}},[t._v(" "+t._s(t.i19signInWithAnotherEmail)+" ")])]):t._e(),o("a-alert",{attrs:{"can-show":t.isWaitingPopup,variant:"info"}},[t._v(" "+t._s(t.i19continueLoginOnPopup)+". ")]),t._l(t.oauthProviders,(function(e){var i=e.link,n=e.faIcon,r=e.providerName,s=e.provider;return o("button",{key:s,staticClass:"login-modal__btn btn btn-block",class:"login-modal__btn--"+s,attrs:{type:"button"},on:{click:function(e){return t.openOauthPopup(i,s)}}},[o("span",{staticClass:"login-modal__btn-icon"},[o("i",{class:"fab "+n})]),t._v(" "+t._s(t.hasNoProfileFound?t.i19signUpWith:t.i19signInWith)+" "+t._s(r)+" ")])})),t.hasNoProfileFound?o("div",{staticClass:"login-modal__visitor-info"},[t._v(" "+t._s(t.i19guestCheckoutMsg)+" ")]):o("button",{key:"email",staticClass:"login-modal__btn btn btn-block btn-secondary",attrs:{type:"button"},on:{click:function(e){t.isLoginForm=!0}}},[o("span",{staticClass:"login-modal__btn-icon"},[o("i",{staticClass:"fas fa-envelope"})]),t._v(" "+t._s(t.i19signInWith+" "+t.i19email)+" ")])],2)])],1)],2)])],1)}),[],!1,null,null,null).exports);e.default=(t={},e="login-modal",o="user-button")=>{const i=document.getElementById(e),r=document.getElementById(o);if(i&&r){const o=window.storefront&&window.storefront.getScopedSlots;new n.a({data:{isVisible:!1},created(){r.addEventListener("click",t=>{t.preventDefault(),this.isVisible=!0})},render(n){const r=this;return n(L,{attrs:{id:e},props:{...t.props,isVisible:r.isVisible},on:{"update:is-visible"(t){r.isVisible=t}},scopedSlots:"function"==typeof o?o(i,n):void 0})}}).$mount(i)}}}]).default}));
//# sourceMappingURL=widget-user.min.js.map